# 驗收測試撰寫指引

本文件說明如何撰寫 Gherkin 格式的驗收測試，特別是視角區分的重要性。

## 視角區分：完成檢查 vs. 驗收測試

在撰寫驗收測試時，必須清楚區分「完成檢查」與「驗收測試」的視角差異：

### 完成檢查（開發者視角）

- **目的**：驗證技術實作的正確性
- **執行時機**：每個任務完成後立即執行
- **檢查方式範例**：
  - 執行單元測試或整合測試
  - 使用 supabase mcp 直接查詢資料庫欄位
  - 使用 curl 測試 API 端點回應
  - 檢查日誌檔案或建置輸出
  - 驗證檔案結構或設定檔內容

### 驗收測試（使用者視角為主，開發者視角輔助）

- **目的**：驗證功能符合使用者需求和預期體驗
- **執行時機**：所有任務完成後的系統性驗證
- **主要檢查方式（使用者視角）**：
  - 使用 playwright mcp 開啟瀏覽器，模擬使用者操作 UI
  - 驗證使用者可見的介面元素（按鈕、表單、訊息等）
  - 測試完整的使用者流程（註冊 → 登入 → 使用功能）
  - 確認使用者可感知的行為（頁面跳轉、錯誤提示、成功訊息等）
- **輔助檢查方式（開發者視角）**：
  - 使用 supabase mcp 確認資料正確寫入或更新到資料庫
  - 驗證後端狀態與 UI 顯示一致
  - 確保端對端流程的資料完整性

## 視角區分範例

假設功能：「新增用戶個人資料欄位」

### 錯誤範例（驗收測試只用開發者視角）

```gherkin
場景: 新增用戶個人資料欄位
  假設 系統已啟動
  當 使用 supabase mcp 查詢 users 表格
  那麼 應該看到 bio 和 avatar_url 欄位存在
```

這個範例的問題是：只驗證了資料庫欄位存在，沒有驗證使用者是否能實際使用這個功能。

### 正確範例（使用者視角為主，開發者視角輔助）

**完成檢查（implementation.md 中）**：
- 使用 supabase mcp 查詢 users 表格，確認 bio 和 avatar_url 欄位存在

**驗收測試（acceptance.feature 中）**：
```gherkin
場景: 用戶可以編輯個人資料
  假設 用戶已登入系統
  當 使用 playwright mcp 開啟個人資料頁面
  並且 在「自我介紹」欄位輸入「我是一位軟體工程師」
  並且 上傳大頭貼圖片
  並且 點擊「儲存」按鈕
  那麼 應該看到「個人資料已更新」的成功訊息
  並且 重新整理頁面後，自我介紹和大頭貼仍然正確顯示
  # 輔助驗證：確認資料正確儲存
  並且 使用 supabase mcp 查詢該用戶的 bio 欄位，應該包含「軟體工程師」
```

這個範例展示了：先用使用者視角驗證 UI 操作和回饋，再用開發者視角確認資料確實正確儲存。

## 撰寫驗收測試的關鍵原則

1. **以使用者旅程為主**：描述使用者如何與系統互動，這是驗收測試的核心
2. **優先使用 UI 驗證**：盡可能透過 playwright mcp 驗證使用者可見的介面
3. **開發者視角作為輔助**：可以用 supabase mcp 等工具確認資料正確儲存，但不應取代使用者視角
4. **關注使用者價值**：驗證使用者能否達成目標，技術驗證是輔助確認

## Gherkin 語法注意事項

- 使用 `# language: zh-TW` 標籤啟用繁體中文
- 關鍵字對應：
  - Feature → 功能
  - Background → 背景
  - Scenario → 場景
  - Scenario Outline → 場景大綱
  - Given → 假設
  - When → 當
  - Then → 那麼
  - And → 並且
  - Examples → 例子
