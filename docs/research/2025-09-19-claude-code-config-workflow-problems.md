# claude-code-config 工作流程問題分析

## 執行摘要

本研究針對使用者在使用 claude-code-config 指令與 sub agent 進行開發時遇到的三個核心問題進行深入分析。經過全面的程式碼審查和工作流程檢視，我們發現這些問題源於指令間缺乏有效的文件參考機制和資訊傳遞不完整。具體而言，process-task-list 指令缺乏對上下文文件的讀取能力，acceptance-tester agent 沒有接收到必要的文件參數，以及 implementation.md 的生成過程中實作細節的保留不夠充分。

這些問題影響了開發者在實作過程中對需求的理解，降低了驗收測試的準確性，並可能導致實作方向偏離原始設計意圖。

## 背景與脈絡

claude-code-config 是一個為 Claude Code 和其他 AI 助手設計的標準化工作流程指令集，提供從需求研究、PRD 撰寫到實作任務管理的完整開發方法論。系統採用模組化設計，核心包含四個主要指令：research、create-prd、create-impl-plan 和 process-task-list，以及專門的 acceptance-tester agent。

專案的設計理念是支援線性工作流程：research → PRD → implementation planning → task execution → acceptance testing。每個階段都會產生對應的文件，形成完整的開發記錄。然而，在實際使用過程中，使用者發現各階段間的資訊傳遞存在斷層，特別是在任務執行和驗收測試階段。

## 研究問題與發現過程

使用者報告的三個問題反映了工作流程中資訊孤島的現象。我透過系統性地檢視每個指令文件的設計目標、執行流程和輸出格式，並分析實際的範例文件，逐步定位了問題的根本原因。研究過程中發現，雖然系統整體架構設計良好，但在實作細節的傳遞和跨指令的文件參考方面存在明顯的設計缺失。

## 技術分析：深入理解問題

### 程式碼庫現況探索

claude-code-config 採用基於 Markdown 的指令系統，每個指令都是獨立的 .md 文件，包含完整的執行指導和輸出格式規範。專案結構清晰，文件組織良好，但各指令間的耦合性較低，這在提供模組化彈性的同時，也造成了資訊傳遞的障礙。

從技術架構角度來看，系統當前的設計假設每個指令都能獨立運作，但實際的開發工作流程需要大量的上下文資訊。這種設計哲學與實際使用需求之間的落差，正是問題的根本所在。

### 問題根源追蹤

#### 問題一：process-task-list 無法回頭參考 PRD 和驗收測試文件

**表面現象：** 開發者在執行任務時缺乏對需求背景的理解
**根本原因：** process-task-list.md 第 135-173 行的 AI 指示中，雖然詳細說明了任務管理機制，但完全沒有要求讀取或參考 PRD 文件

**詳細分析：**
- process-task-list.md:135-138 行：僅要求讀取 implementation.md，但沒有要求讀取 PRD
- 雖然 implementation.md 中有 PRD 參考路徑（create-impl-plan.md:45），但這只是靜態資訊
- 指令設計上假設 implementation.md 包含所有必要資訊，但實際上許多商業邏輯和技術決策背景只存在於 PRD 中

#### 問題二：acceptance-tester agent 缺乏文件傳遞

**表面現象：** 驗收測試執行時缺少必要的上下文資訊
**根本原因：** process-task-list.md:165-167 行提到使用 acceptance-tester agent，但沒有指定要傳遞哪些文件

**詳細分析：**
- acceptance-tester.md:13 行明確列出需要三個文件：implementation.md、acceptance.feature、prd.md
- process-task-list.md:165 行僅說明觸發條件，沒有文件傳遞指示
- 缺乏明確的 Task tool 使用指導，包括 prompt 參數應該包含哪些文件路徑

#### 問題三：implementation.md 實作細節不足

**表面現象：** 任務描述過於概略，缺乏具體的實作指導
**根本原因：** create-impl-plan.md 設計目標與實際執行結果之間存在落差

**詳細分析：**
- create-impl-plan.md:26 行要求「涵蓋 PRD 暗示的所有實作要點」，但沒有具體的執行指導
- 目標受眾設定為「初級開發人員」（第 162 行），但實際生成的內容更像是高階任務大綱
- 第 24 行雖然提到讀取研究文件，但沒有要求將研究發現轉化為具體的實作細節

### 業界智慧與最佳實踐

調研顯示，成功的 AI 輔助開發工具通常採用「上下文豐富」的方法，確保每個執行階段都能獲得充分的背景資訊。例如，GitHub Copilot 會分析整個檔案的上下文，而非僅依賴當前行的資訊。

在工作流程管理方面，現代的 CI/CD 系統如 GitHub Actions 採用明確的 artifact 傳遞機制，確保各階段間的資料完整性。這種設計原則可以應用到我們的指令系統中。

相關的軟體工程最佳實踐包括：
- **資訊一致性原則：** 確保決策上下文在整個開發流程中保持可訪問
- **可追溯性要求：** 每個實作決策都應該能夠回溯到原始需求
- **分階段驗證：** 每個階段的輸出都應該包含足夠的資訊供下一階段使用

## 解決方案探索與評估

基於問題分析，我評估了三種主要的解決方案途徑，每種都有不同的實作複雜度和維護影響。

**方案一：增強 process-task-list 的文件讀取能力**
這個方案透過修改 process-task-list.md 的 AI 指示，要求在任務執行前讀取 PRD 和相關研究文件。優點是實作簡單，只需要修改一個文件，且能夠直接解決問題一。缺點是增加了每次任務執行的開銷，可能影響效能。

**方案二：優化 agent 調用的文件傳遞機制**
透過明確指定 Task tool 的使用方式，確保 acceptance-tester agent 能夠接收到所有必要的文件。這個方案需要修改 process-task-list.md 中關於驗收測試的指導，增加具體的文件路徑傳遞說明。

**方案三：穩定化 implementation.md 的內容生成品質**
透過修改 create-impl-plan.md，增加更具體的品質檢核和生成指導，確保無論 PRD 複雜度如何都能產生足夠詳細的實作計畫。真實案例顯示當 PRD 詳細時品質很好，需要確保所有情況下都能達到類似水準。

### 方案評估

**方案一：增強文件讀取**
- **實作複雜度：** 低 - 只需修改 process-task-list.md 的 AI 指示部分
- **維護影響：** 低 - 不影響現有文件結構和工作流程
- **風險等級：** 低 - 向後相容，不會破壞現有功能

**方案二：優化 agent 調用**
- **實作複雜度：** 中 - 需要詳細設計 Task tool 的使用方式
- **維護影響：** 中 - 需要確保文件路徑的準確性和可用性
- **風險等級：** 低 - 主要是新增功能，不影響現有邏輯

**方案三：穩定化內容生成**
- **實作複雜度：** 中 - 需要改善生成指導而非重新設計
- **維護影響：** 低 - 主要是增強現有機制，不改變基本格式
- **風險等級：** 低 - 真實案例顯示現有機制可以產生高品質結果

## 建議與決策指引

基於分析結果、真實案例驗證和用戶直接反饋，最重要的問題是**實作脈絡遺失**。

### 主要解決方案

**在 implementation.md 中新增「實作參考資訊」章節**，保留來自 research 文件和 PRD 的實作相關技術資訊，包括：
- 程式碼範例和實作示範
- 技術選型的詳細分析
- 架構決策和設計模式
- 已驗證的解決方案

### 實施順序

1. **第一優先**：修改 `create-impl-plan.md`，新增實作資訊萃取和新章節
2. **第二優先**：修改 `process-task-list.md`，增加 PRD 文件讀取
3. **第三優先**：完善 acceptance-tester 的文件傳遞

## 具體實作方法

### 步驟一：修改 create-impl-plan.md

**目標**：在 implementation.md 中新增「實作參考資訊」章節

**修改內容**：
1. 更新流程第 2 步，增加識別和提取實作相關技術資訊的指導
2. 在 implementation.md 結構中新增章節，包含三個子部分：
   - 來自研究文件的技術洞察
   - 來自 PRD 的實作細節
   - 關鍵技術決策

### 步驟二：修改 process-task-list.md

**目標**：讓 process-task-list 能夠讀取 PRD 和 research 文件

**修改內容**：在 AI 指示中增加讀取 PRD 文件的要求

### 步驟三：修改 process-task-list.md

**目標**：確保 acceptance-tester 能接收到所有必要文件

**修改內容**：明確指定 Task tool 需要傳遞的文件路徑

## 後續研究建議

建議撰寫「claude-code-config 實作脈絡傳遞增強」PRD，基於本研究的發現為系統性改善提供詳細規格。

## 真實案例驗證的新發現

在研究過程中，透過分析 `reference/2025-09-13-notes-navigation-sidebar/` 這個真實使用案例，我們發現了一些重要的新洞察，需要修正原本的研究結論。

### 關鍵發現

1. **Implementation.md 品質實際上相當好**：
   - 該案例的 implementation.md 包含詳細的技術實作要求
   - 任務描述具體且可執行，包含介面定義、hook 實作、測試策略
   - 檔案列表非常完整，包括測試檔案
   - TDD 標註被廣泛使用，顯示功能運作良好

2. **PRD 到 Implementation 的轉換效果很好**：
   - PRD 中的技術考量（如 lib/notes.ts、響應式設計）都有轉移到 implementation.md
   - 具體的技術需求（如樹狀結構、狀態管理）都有對應的任務
   - 甚至包括了測試策略和無障礙性考重

3. **驗收測試品質很高**：
   - 場景涵蓋了所有主要功能
   - 包含響應式設計的測試
   - 有具體的操作步驟和預期結果
   - 甚至包含場景大綱來測試不同檔案類型

### 對研究結論的影響

這個真實案例讓我們重新評估了問題的優先級：

1. **問題三的優先級降低**：當 PRD 詳細且技術導向時，現有機制能產生高品質的 implementation.md
2. **問題可能與情境相關**：實作細節不足可能更多發生在 PRD 較簡略或缺乏技術背景的情況
3. **需要更多案例驗證**：單一案例不足以得出全面結論，需要收集更多不同類型的實際使用案例

### 基於真實案例和用戶反饋的核心問題

結合真實案例分析和用戶直接反饋，我們識別出最關鍵的問題是**實作脈絡遺失**：

**核心問題：** research 文件或 PRD 中的實作範例、技術討論和具體解決方案沒有被有效傳遞到 implementation.md，導致開發者無法接觸到這些寶貴的實作思路。

**具體表現：**
- 與 AI 開發工具討論過的實作範例被遺失
- 技術選型的詳細分析沒有保留
- 已驗證的解決方案無法在實作階段參考

**設計考量：**
根據 README.md，`/research` 是輔助功能（選用），核心工作流程是三步驟：需求澄清 → 實作規劃 → 任務執行。因此需要考慮有 research 文件和沒有 research 文件兩種情況。

## 參考資料

### 技術文件
- `commands/process-task-list.md:135-173` - AI 指示和任務管理機制
- `commands/create-impl-plan.md:24-27` - PRD 分析和任務生成流程
- `agents/acceptance-tester.md:13` - 所需文件列表和執行流程

### 實作範例
- `docs/specs/2025-08-29-tdd-implementation-support/` - 典型的工作流程範例
- `docs/specs/2025-08-20-install-config-script/` - 另一個完整的規格範例
- `reference/2025-09-13-notes-navigation-sidebar/` - 高品質 implementation.md 的真實案例，顯示現有機制的優良表現

### 延伸閱讀
- GitHub Actions artifact 機制 - 工作流程間資料傳遞的最佳實踐
- 軟體工程中的可追溯性要求 - 需求與實作間的關聯管理
- AI 輔助開發的上下文管理 - 提升 AI 協作效果的策略