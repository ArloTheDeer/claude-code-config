# 實作脈絡傳遞增強功能 PRD

**日期：** 2025-09-19
**功能名稱：** 實作脈絡傳遞增強 (Implementation Context Transfer Enhancement)

## 簡介/概述

基於 `docs/research/2025-09-19-claude-code-config-workflow-problems.md` 中的研究發現，claude-code-config 工作流程存在實作脈絡遺失的問題。具體而言，research 文件和 PRD 中的實作範例、技術討論和具體解決方案無法有效傳遞到 implementation.md，導致開發者無法接觸到這些寶貴的實作思路。

此功能將增強 claude-code-config 的文件生成和任務執行機制，確保實作相關的技術資訊能夠完整地從研究階段傳遞到實作階段，提升開發效率和實作品質。

## 目標

1. **解決實作脈絡遺失問題：** 確保 research 文件和 PRD 中的程式碼範例、技術討論能夠保留在 implementation.md 中
2. **提升實作計畫品質：** 讓 implementation.md 包含足夠的技術細節，支援開發者進行具體實作
3. **改善工作流程連貫性：** 建立有效的跨文件資訊傳遞機制，確保各階段的技術決策不會遺失
4. **增強任務執行時的上下文理解：** 讓執行任務時能夠存取完整的需求背景和技術脈絡

## 使用者故事

### 故事 1：實作參考資訊保留
**作為一個使用 claude-code-config 的開發者，** 我希望在 implementation.md 中能看到來自 research 文件和 PRD 的實作範例和技術討論，**以便** 我能夠參考這些已經驗證的解決方案和技術決策來進行實作。

### 故事 2：完整的技術脈絡傳遞
**作為一個使用 claude-code-config 的開發者，** 我希望在執行任務時能夠了解功能的商業背景和技術要求，**以便** 我的實作方向能夠符合原始的設計意圖和需求。

### 故事 3：靈活的文件結構支援
**作為一個使用 claude-code-config 的開發者，** 我希望無論是否有 research 文件，都能獲得一致的實作指導品質，**以便** 我能在不同的專案情境下都有良好的開發體驗。

## 功能需求

### 實作參考資訊章節功能

1. **系統必須在 implementation.md 中新增「實作參考資訊」章節**，位於文件最後面（任務清單之後）。

2. **系統必須從 research 文件中萃取實作相關資訊**，包括：
   - 程式碼範例和實作示範
   - 技術選型的詳細分析和理由
   - 架構決策和設計模式
   - 已驗證的解決方案和最佳實踐

3. **系統必須從 PRD 文件中萃取實作相關資訊**，包括：
   - 技術架構決策和理由
   - 具體的 API 設計或檔案結構
   - PRD 中提到的實作範例
   - 技術限制和考量事項

4. **系統必須將萃取的資訊組織成三個子章節**：
   - 來自研究文件的技術洞察（如無 research 文件則留空或省略）
   - 來自 PRD 的實作細節
   - 關鍵技術決策總結

5. **系統必須支援有 research 文件和無 research 文件兩種情境**，確保在沒有 research 文件時仍能正常運作。

### 任務執行時的文件參考功能

6. **系統必須在執行任務時讀取 PRD 文件**，以獲得功能背景和技術脈絡。

7. **系統必須在 PRD 引用 research 文件時**，同時讀取相關研究文件以獲得完整的背景資訊。

8. **系統必須在執行每個任務前**，提供與該任務相關的 PRD 背景資訊和技術要求。

### acceptance-tester 文件傳遞功能

9. **系統必須在調用 acceptance-tester agent 時**，明確指定要傳遞的文件路徑，包括：
   - implementation.md 的相對路徑（基於專案根目錄）
   - acceptance.feature 的相對路徑（基於專案根目錄）
   - PRD 文件的相對路徑（基於專案根目錄）

10. **系統必須在 Task tool 的 prompt 參數中**，包含具體的文件路徑和執行指示，確保 acceptance-tester agent 能夠讀取所有必要文件。

## 非目標（超出範圍）

1. **文件格式的重大變更：** 不改變現有 PRD 或 research 文件的基本結構
2. **自動化品質檢核：** 不包含自動化的實作資訊萃取品質檢查機制
3. **歷史文件的回溯更新：** 不自動更新既有的 implementation.md 文件
4. **複雜的資訊分析：** 不包含 AI 對技術資訊的深度解析或優化建議

## 設計考量

### 實作參考資訊章節設計
- 採用清晰的三層結構：研究洞察 → PRD 細節 → 技術決策總結
- 每個子章節都包含文件路徑參考，方便追溯來源
- 使用條列式組織，便於快速掃描和參考
- 避免與下方任務清單內容重複

### 資訊萃取策略
- 重點識別實作相關的技術內容，排除純理論討論
- 保留程式碼範例的完整性和可執行性
- 確保技術決策包含足夠的背景脈絡
- 維持資訊的簡潔性，避免資訊過載

## 技術考量

### 現有系統整合
- 修改 `commands/create-impl-plan.md` 的流程第 2 步和輸出格式
- 修改 `commands/process-task-list.md` 的 AI 指示部分
- 保持與現有 TodoWrite 工具和 Git 工作流程的相容性

### 檔案處理
- 支援相對路徑和絕對路徑的檔案引用
- 處理 research 文件不存在的情況
- 確保檔案讀取錯誤不會中斷整個流程

### 語言一致性
- 維持與使用者對話語言的一致性
- 程式碼範例和技術內容使用英文
- 文件結構和說明文字使用對話語言

## 開放問題

1. **資訊萃取的粒度控制：** 如何平衡實作資訊的完整性與簡潔性？
2. **重複資訊的處理：** 當 research 和 PRD 包含相似技術資訊時，如何避免重複？
3. **大型技術文件的處理：** 對於包含大量技術資訊的 research 文件，是否需要長度限制？
4. **多語言專案支援：** 如何處理包含多種程式語言技術資訊的專案？

## 參考資料

- `docs/research/2025-09-19-claude-code-config-workflow-problems.md` - 問題分析和解決方案研究
- `reference/2025-09-13-notes-navigation-sidebar/` - 高品質 implementation.md 的真實案例
- `commands/create-impl-plan.md` - 當前的實作計畫生成流程
- `commands/process-task-list.md` - 當前的任務執行流程