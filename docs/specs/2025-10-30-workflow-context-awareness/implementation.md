# 實作計畫

## 研究文件參考

**研究文件路徑：** `docs/research/2025-10-30-workflow-context-awareness-improvement.md`

> **重要提醒：** 實作過程中請經常參考研究文件以了解：
>
> - 問題的根本原因和影響範圍
> - Context Engineering 和 Separation of Concerns 的設計原則
> - 各指令「工作流程脈絡」章節的詳細設計
> - 實施順序和風險控管策略

## 相關檔案

- `commands/create-prd.md` - PRD 生成指令（需新增工作流程脈絡章節）
- `commands/create-impl-plan.md` - 實作計畫生成指令（需新增工作流程脈絡章節）
- `commands/process-task-list.md` - 任務執行指令（需新增工作流程脈絡章節）
- `commands/research.md` - 研究指令（需增強 PRD 整合章節）
- `CLAUDE.md` - 專案說明文件（需記錄此次改進）
- `acceptance.feature` - Gherkin 格式驗收測試場景

## 任務

- [x] 1. 修改 create-prd.md，新增「工作流程脈絡」章節
  - 1.1 在「目標」章節之後（約第 6 行之後）插入新章節
  - 1.2 包含四個子章節：整體開發流程、當前階段的輸入與輸出、當前階段的職責範圍、與其他階段的關係
  - 1.3 特別強調 PRD 的目標讀者是「產品經理、業務人員、專案管理者」，而非開發者
  - 1.4 明確說明「高層次技術方向」的範圍，以及不應包含的內容
  - 1.5 詳細說明當引用 research 文件時，應該「引用」而非「複製」技術細節
  - 1.6 修正「目標讀者」章節（第 43-44 行），將「初級開發者」改為「產品經理和業務人員」

- [ ] 2. 修改 create-impl-plan.md，新增「工作流程脈絡」章節
  - 2.1 在「目標」章節之後（約第 6 行之後）插入新章節
  - 2.2 包含四個子章節：整體開發流程、當前階段的輸入與輸出、當前階段的職責範圍、與其他階段的關係
  - 2.3 強調此階段的目標讀者是「開發者（初級到中級）」
  - 2.4 明確說明「實作參考資訊」章節的重要性，這是技術細節的「承接點」
  - 2.5 說明如何從 research 和 PRD 萃取技術細節

- [ ] 3. 修改 process-task-list.md，新增「工作流程脈絡」章節
  - 3.1 在開頭適當位置（建議在「任務清單管理」標題之前）插入新章節
  - 3.2 包含四個子章節：整體開發流程、當前階段的輸入與輸出、各參考文件的角色、當前階段的職責範圍
  - 3.3 詳細說明 implementation.md、prd.md、acceptance.feature、research 文件各自提供什麼類型的資訊
  - 3.4 強調應該參考 PRD 來理解「為什麼」要這樣實作

- [ ] 4. 修改 research.md，增強「與 PRD 和實作的整合」章節
  - 4.1 找到「與 PRD 和實作的整合」章節（約第 156 行附近）
  - 4.2 在「PRD 撰寫參考」子章節中，新增關於「引用 vs 複製」的詳細說明
  - 4.3 明確說明 PRD 讀者是產品經理和業務人員，技術細節會在 implementation.md 階段被保留
  - 4.4 說明 `/create-impl-plan` 會自動從 research 提取技術細節到「實作參考資訊」章節

- [ ] 5. 更新 CLAUDE.md，記錄此次改進
  - 5.1 在 Core Architecture 或適當章節中，新增關於「工作流程脈絡」的說明
  - 5.2 說明各指令現在都包含對整體工作流程的認知
  - 5.3 強調職責分離原則：PRD 專注商業需求、implementation.md 承接技術細節、process-task-list 執行實作
  - 5.4 更新相關的 Key Workflow Patterns 或 Development Best Practices 章節

- [ ] 6. 執行驗收測試
  - 6.1 使用 AI 讀取 acceptance.feature 檔案
  - 6.2 透過實際使用各個 slash command 執行每個場景
  - 6.3 驗證所有場景通過並記錄結果

## 實作參考資訊

### 來自研究文件的技術洞察
> **文件路徑：** `docs/research/2025-10-30-workflow-context-awareness-improvement.md`

**核心問題分析**：
- 各指令缺乏「工作流程全局觀」，導致職責越界
- create-prd.md 將目標讀者錯誤定義為「初級開發者」（應該是產品經理和業務人員）
- 缺乏對「高層次技術方向」vs「詳細技術實作」的明確界定
- 當引用 research 時，AI 會自然地將技術細節納入 PRD，但應該只「引用」而非「複製」

**設計原則**：
- **Context Engineering**：直接在 AI 執行的 context 中提供必要的全局資訊
- **Separation of Concerns**：每個階段有專注的職責範圍和目標受眾
- **Clear Structure Over Clever Wording**：結構清晰比措辭巧妙更重要

**實作策略**：
- 採用方案一：在各指令中嵌入「工作流程脈絡」章節
- 優先級：create-prd.md > create-impl-plan.md > process-task-list.md > research.md
- 保持章節簡潔（300-500 字），避免影響 AI 理解
- 使用一致的術語和結構

### 各指令的「工作流程脈絡」章節詳細內容

**create-prd.md 的脈絡章節**（研究文件第 215-270 行）：
- 四個子章節：整體開發流程、輸入與輸出、職責範圍、與其他階段的關係
- 強調目標讀者是「產品經理、業務人員、專案管理者」
- 明確定義「應該包含」和「不應該包含」的內容清單
- 特別說明與 research 文件的關係：「引用」研究發現，而非「複製」技術細節
- 提供具體範例：「基於 research 文件的分析，建議採用事件驅動架構」（好的引用）

**create-impl-plan.md 的脈絡章節**（研究文件第 272-326 行）：
- 四個子章節結構與 create-prd.md 一致
- 強調目標讀者是「開發者（初級到中級）」
- 關鍵責任：將 research 和 PRD 的技術細節萃取到「實作參考資訊」章節
- 說明這個階段是技術細節的「承接點」

**process-task-list.md 的脈絡章節**（研究文件第 328-391 行）：
- 特別新增「各參考文件的角色」子章節
- 詳細說明 implementation.md、prd.md、acceptance.feature、research 文件各自的用途
- 強調應該參考 PRD 理解「為什麼」，參考 implementation.md 理解「怎麼做」

**research.md 的改進內容**（研究文件第 393-404 行）：
- 在「PRD 撰寫參考」中新增「引用 vs 複製」的說明
- 提供好的範例（引用）和壞的範例（複製）
- 說明為什麼 PRD 不該包含技術細節：讀者是產品經理和業務人員
- 說明機制：`/create-impl-plan` 會自動提取技術細節

### 關鍵技術決策

**決策一：採用嵌入式設計而非外部引用**
- 原因：避免依賴 AI 主動讀取外部文件的不確定性
- 在 AI 執行的 context 中直接提供必要資訊
- 符合 Context Engineering 原則

**決策二：優先處理 create-prd.md**
- 原因：這是問題最嚴重的地方（經常包含過多技術細節）
- 修正「目標讀者」定義，從「初級開發者」改為「產品經理和業務人員」
- 這個改變會立即改善 PRD 的產出品質

**決策三：保持章節簡潔**
- 目標：300-500 字
- 原因：避免章節過長影響 AI 理解
- 使用清晰的結構和一致的術語

**決策四：純新增內容，不修改現有邏輯**
- 原因：降低風險，保持向後相容
- 使用者已有的使用習慣不受影響
- 如果效果不佳，可以快速回退

**決策五：在 CLAUDE.md 中記錄改進**
- 原因：讓使用者和未來的維護者了解這次改進的目的
- 強化專案文件中對職責分離原則的說明
- 提供工作流程的整體視角
