# TDD 實作流程支援功能 PRD

## 簡介/概述

為了提升軟體品質和開發效率，我們需要增強現有的 `create-impl-plan.md` 指令，使其能夠同時支援傳統實作流程和測試驅動開發（TDD）流程。目前的實作計畫生成器只支援驗收測試，缺乏對元件級別 TDD 的支援。

此功能將在使用者明確請求 TDD 時，將傳統的任務清單轉換為完整的 TDD 循環工作流程，確保每個主要任務都遵循紅燈-綠燈-重構的 TDD 原則。

## 目標

1. **支援雙重開發模式：** 保持現有的傳統開發流程，同時新增 TDD 開發流程選項
2. **標準化 TDD 實作：** 為每個主要任務提供統一的 TDD 流程模板
3. **提升測試覆蓋率：** 透過強制性的測試先行開發，確保每個元件都有適當的測試
4. **降低認知負擔：** 透過階段性確認機制，避免開發者一次面對過多測試需求
5. **保持向後相容：** 確保現有指令在未指定 TDD 時的行為完全不變

## 使用者故事

### 故事 1：TDD 開發流程
**作為一個開發者，** 我希望在使用 `/create-impl-plan` 指令時能夠指定使用 TDD 模式，**以便** 我能夠按照測試驅動的方式實作功能，確保程式碼品質和可測試性。

### 故事 2：階段性測試確認
**作為一個開發者，** 我希望在撰寫測試邏輯前先確認測試敘述的範圍，**以便** 我能夠控制測試的複雜度，避免一次撰寫過多測試造成認知過載。

### 故事 3：傳統開發模式保留
**作為一個開發者，** 我希望在不需要 TDD 時，指令的行為與現有完全一致，**以便** 我能夠根據專案需求靈活選擇開發模式。

## 功能需求

1. **指令觸發機制：** 當使用者在 `/create-impl-plan` 對話中提及「TDD」時，系統應自動啟用 TDD 模式。

2. **TDD 流程模板：** 系統必須將每個主要任務（如任務 1、2、3）轉換為標準的 TDD 循環，包含 8 個子步驟：
   - 撰寫空的類別/函式並拋出未實作錯誤
   - 撰寫測試敘述（describe/it 結構）
   - 實作測試邏輯
   - 執行測試確保失敗（紅燈階段）
   - 原始實作要點（多個）
   - 執行測試確保成功（綠燈階段）

3. **開發者確認機制：** 在測試敘述撰寫後，系統必須明確停下來要求開發者審核，確保測試範圍合宜後再繼續。

4. **文件整合：** 在 `create-impl-plan.md` 中新增 TDD 流程指導章節，並在流程第 4 點中引用該章節內容。

5. **測試框架標準化：** 使用 `describe/it` 語法風格，並使用 `throw new Error('Not implemented')` 作為未實作錯誤。

6. **驗收測試保留：** TDD 流程與現有的 Gherkin 格式驗收測試互補，不取代原有驗收測試機制。

## 非目標（超出範圍）

1. **複雜測試配置：** 不包含複雜的測試環境配置或多重測試框架整合
2. **測試框架安裝：** 不負責安裝或配置測試框架
3. **重構階段指導：** 不包含 TDD 的重構階段詳細指導
4. **強制性 TDD：** 不強制所有專案都使用 TDD，保持使用者選擇權
5. **測試覆蓋率分析：** 不包含測試覆蓋率的分析或報告功能

## 設計考量

### 文件結構
- 在 `commands/create-impl-plan.md` 末尾新增「TDD 實作流程指導」章節
- 修改 `commands/create-impl-plan.md` 流程第 4 點，增加條件引用新章節的邏輯

### 任務轉換邏輯
原始任務結構：
```
- [ ] 1. 任務標題
  - 1.1 實作要點描述
  - 1.2 實作要點描述
```

TDD 模式下轉換為：
```
- [ ] 1. 任務標題
  - [ ] 1.1 撰寫空的類別、函式並拋出未實作錯誤
  - [ ] 1.2 撰寫測試敘述
  - [ ] 1.3 實作測試邏輯
  - [ ] 1.4 執行測試，確保測試失敗
  - [ ] 1.5 實作要點描述（原本任務）
  - [ ] 1.6 實作要點描述（原本任務）
  - [ ] 1.7 執行測試，確保測試成功
```

## 技術考量

1. **與現有系統整合：** 必須確保對現有 `create-impl-plan.md` 的修改最小化，避免破壞現有功能
2. **章節引用機制：** 使用條件式章節引用，只在偵測到 TDD 需求時才引用新增的 TDD 流程章節
3. **向後相容性：** 確保未提及 TDD 的現有使用方式完全不受影響

## 開放問題

1. 是否需要為不同程式語言提供不同的測試框架模板？
2. 是否需要為 TDD 流程提供範例或教學？
3. 子任務的測試是否需要特殊處理？

## 參考資料

- 現有的 `commands/create-impl-plan.md` 實作
- Claude Code 指令系統架構