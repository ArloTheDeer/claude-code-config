# 產品需求文件 (PRD) - Agents 目錄安裝功能

## 簡介/概述

本功能旨在為現有的 `npm run install-config` 命令新增 agents 目錄的安裝支援，使其能夠將 agents 目錄中的檔案複製到 `~/.claude/agents` 目錄中，與現有的 commands 安裝功能保持一致的行為模式。目前系統已經實作了 commands 目錄的安裝功能，但缺少 agents 目錄的對應功能，導致開發者需要手動處理 agents 檔案的部署。

## 目標

1. **功能完整性：** 讓 `npm run install-config` 命令同時支援 commands 和 agents 目錄的安裝
2. **一致性：** agents 安裝行為與現有 commands 安裝行為保持完全一致
3. **跨平台兼容：** 支援 Windows、macOS 和 Linux 平台
4. **開發效率：** 開發者可透過單一命令完成所有設定檔的部署

## 使用者故事

1. **作為開發者，我希望執行 `npm run install-config` 時能同時安裝 commands 和 agents 目錄的所有檔案，這樣我就不需要分別處理兩種類型的設定檔。**

2. **作為開發者，我希望 agents 安裝功能能夠檢測檔案衝突並提供 overwrite 選項，就像 commands 安裝功能一樣，這樣我可以安全地管理檔案更新。**

3. **作為開發者，我希望看到清楚的安裝進度和結果報告，包括成功安裝的 agents 檔案清單。**

## 功能需求

1. **FR-001：** 系統必須在執行 `npm run install-config` 時同時處理 commands 和 agents 目錄
2. **FR-002：** 系統必須將 agents 目錄中的所有 .md 檔案複製到 `~/.claude/agents` 目錄
3. **FR-003：** 系統必須在目標目錄不存在時自動建立 `~/.claude/agents` 目錄
4. **FR-004：** 系統必須檢測 `~/.claude/agents` 目錄中的檔案衝突
5. **FR-005：** 系統必須在發現檔案衝突且未指定 overwrite 旗標時停止安裝並提示使用者
6. **FR-006：** 系統必須支援 `overwrite` 旗標來覆蓋現有檔案
7. **FR-007：** 系統必須提供詳細的安裝過程日誌，包含：
   - 找到的檔案數量和檔案名稱
   - 檔案衝突警告
   - 複製進度
   - 最終安裝結果摘要
8. **FR-008：** 系統必須在安裝完成後顯示已安裝的 agents 檔案清單
9. **FR-009：** 系統必須支援跨平台路徑處理（Windows、macOS、Linux）
10. **FR-010：** 系統必須在任何安裝步驟失敗時提供適當的錯誤訊息並結束程序

## 非目標（超出範圍）

1. **選擇性安裝：** 本版本不支援選擇特定 agents 檔案進行安裝
2. **版本管理：** 不包含檔案版本控制或回滾功能
3. **設定檔驗證：** 不驗證 agents 檔案的格式或內容正確性
4. **交互式介面：** 不提供互動式的檔案選擇或確認介面
5. **備份功能：** 不自動備份被覆蓋的檔案

## 設計考量

**目錄結構：**
安裝後的 `~/.claude` 目錄結構應為：
```
~/.claude/
├── commands/
│   ├── create-prd.md
│   ├── research.md
│   └── ...
└── agents/
    ├── tdd-developer.md
    └── ...
```

**行為一致性：**
agents 安裝功能必須完全複製 commands 安裝功能的行為模式，包括：
- 相同的日誌格式和訊息風格
- 相同的錯誤處理方式
- 相同的 overwrite 旗標處理邏輯

## 技術考量

1. **現有架構整合：** 功能應整合到現有的 `scripts/install-config.js` 檔案中
2. **依賴性：** 繼續使用現有的 shelljs 套件進行檔案操作
3. **錯誤處理：** 遵循現有的錯誤處理模式
4. **效能：** 同時處理兩個目錄不應顯著增加執行時間
5. **可維護性：** 程式碼應避免重複，考慮將共通邏輯抽取為可重用函數

## 開放問題

1. 如果 agents 目錄不存在或為空，系統應該如何回應？
2. 是否需要在安裝過程中區分顯示 commands 和 agents 的安裝結果？
3. 如果其中一個目錄（commands 或 agents）安裝失敗，整個程序應該如何處理？

## 參考資料

- 現有 commands 安裝功能實作：`scripts/install-config.js`
- 現有 agents 目錄結構：`agents/` 目錄