# Process-Task-List 命令 TDD 任務分解增強功能 PRD

## 簡介/概述

目前 `process-task-list` 命令能將 `implementation.md` 中的任務項目同步到 Claude Code 的 TodoWrite 工具中，但對於標註「使用 TDD 開發流程」的任務，缺乏細化的步驟管理。此功能將增強 TDD 任務的處理，將單一 TDD 任務自動分解為多個詳細步驟，提供更精細的進度追蹤和更好的開發流程管理。

## 目標

1. **自動化 TDD 任務分解**：當偵測到「使用 TDD 開發流程」標註時，自動將任務分解為 TDD 工作流程的各個階段
2. **動態任務展開**：僅在需要時展開任務，避免 todo 清單過於複雜
3. **保持現有功能完整性**：在增加新功能的同時，保持 `process-task-list` 命令的所有現有功能
4. **改善開發者體驗**：提供更清晰的 TDD 進度可視化和任務管理

## 使用者故事

1. **作為開發者**，我想要在執行 TDD 任務時看到詳細的步驟分解，以便我能清楚了解 TDD 流程的進度
2. **作為專案管理者**，我想要追蹤 TDD 任務的各個階段完成情況，以便更好地評估開發進度
3. **作為 AI 助理**，我想要自動管理 TDD 任務的展開和收合，以便保持任務清單的清晰度
4. **作為團隊成員**，我想要在 `implementation.md` 中看到 TDD 任務的完整狀態，以便了解專案的實際進展

## 功能需求

### 1. TDD 任務識別機制
1.1. 系統必須能偵測任務標題中的「使用 TDD 開發流程」標註  
1.2. 系統必須區分 TDD 任務與一般任務的處理方式

### 2. TDD 任務分解邏輯  
2.1. 當 TDD 任務標記為 `in_progress` 時，系統必須自動分解為以下子任務：
   - `[任務名稱] - 先跑測試`
   - `[任務名稱] - 寫空介面`  
   - `[任務名稱] - 寫測試敘述`
   - `[任務名稱] - 實作測試邏輯`
   - `[任務名稱] - 跑測試（紅燈階段）`
   - `[任務名稱] - 實作實際程式碼`
   - `[任務名稱] - 再次跑測試（綠燈階段）`

2.2. 子任務必須按順序執行，同時只能有一個子任務處於 `in_progress` 狀態  
2.3. 所有子任務完成後，母任務才能標記為 `completed`

### 3. 動態任務管理
3.1. 系統必須只展開當前正在處理的 TDD 任務  
3.2. 尚未開始的 TDD 任務必須保持摺疊狀態  
3.3. 完成的 TDD 任務可以收合或保持展開狀態以供檢視

### 4. 簡化同步機制
4.1. 系統必須將 TDD 任務從 `implementation.md` 展開到 TodoWrite 工具中  
4.2. TDD 子任務僅在 TodoWrite 工具中管理，不同步回 `implementation.md`  
4.3. 只有在所有 TDD 子任務完成後，才將母任務在 `implementation.md` 中標記為 `[x]`

### 5. 非 TDD 任務相容性
5.1. 沒有「使用 TDD 開發流程」標註的任務必須維持原有的處理方式  
5.2. 混合任務清單（TDD 和非 TDD）必須能正常運作

## 非目標（超出範圍）

- 不修改 TDD 工作流程的具體步驟內容
- 不提供 TDD 測試失敗的自動回滾機制
- 不改變 `implementation.md` 的基本格式結構
- 不影響現有的 git commit 和檔案管理功能
- 不提供自訂 TDD 步驟的功能

## 技術考量

### 任務狀態邏輯
- 母任務狀態依賴於所有子任務的完成狀態
- 子任務必須按照 TDD 流程的順序進行
- 需要維護母任務與子任務之間的關聯關係

### 單向同步機制
- TodoWrite 工具需要處理 TDD 任務的動態展開
- `implementation.md` 僅需要支援母任務完成狀態的更新
- 需要維護母任務與子任務完成狀態的對應關係

### 向後相容性
- 現有的任務處理邏輯必須不受影響
- 已存在的 `implementation.md` 檔案必須能正常處理
- 所有現有的同步和提交功能必須保持運作

## 設計考量

### 任務展示格式
在 TodoWrite 中：
```
- [ ] 建立檔案掃描和路由生成工具 - 先跑測試
- [ ] 建立檔案掃描和路由生成工具 - 寫空介面
- [ ] 建立檔案掃描和路由生成工具 - 寫測試敘述
  ... (其他步驟)
- [ ] 建立 URL 編碼處理工具 (待展開)
- [ ] 實作動態筆記頁面元件 (待展開)
```

在 `implementation.md` 中（保持原有格式）：
```markdown
- [ ] 建立檔案掃描和路由生成工具 - 使用 TDD 開發流程
  - 1.1 掃描指定目錄下的 markdown 檔案
  - 1.2 生成對應的路由結構
  - 1.3 處理檔案路徑和 URL 編碼
- [ ] 建立 URL 編碼處理工具 - 使用 TDD 開發流程
- [ ] 實作動態筆記頁面元件 - 使用 TDD 開發流程
```

## 開放問題

1. 當用戶手動修改 `implementation.md` 中的 TDD 子任務時，如何處理同步衝突？
2. 是否需要支援部分完成的 TDD 任務在重新啟動對話時的狀態恢復？
3. 如果 TDD 流程中某個步驟需要重複執行，如何在任務清單中反映？

## 參考資料

- 現有的 `commands/process-task-list.md` 檔案中的 TDD 開發流程章節
- Claude Code TodoWrite 工具的使用方式和限制