# 從 PRD 生成任務清單

## 目標

引導 AI 助手根據現有的產品需求文件（PRD）創建詳細的、逐步的 Markdown 格式任務清單。該任務清單應指導開發人員完成實作。

## 輸出

### 主要任務清單

- **格式：** Markdown (`.md`)
- **位置：** `/docs/specs/[prd-slug-name]`
- **檔案名稱：** `implementation.md`

### 驗收條件檔案

- **格式：** Gherkin (`.feature`)
- **位置：** `/docs/specs/[prd-slug-name]`
- **檔案名稱：** `acceptance.feature`

## 流程

1.  **接收 PRD 參考：** 用戶指向特定的 PRD 檔案
2.  **分析 PRD：** AI 讀取並分析指定 PRD 的功能需求、用戶故事和其他部分。如果 PRD 中引用了研究文件，也一併讀取相關研究以獲得更深入的背景資訊。
3.  **評估現狀：** 檢視現有程式碼庫，了解現有的基礎設施、架構模式和慣例。同時，識別任何已存在且可能與 PRD 需求相關的元件或功能。然後，識別可以利用或需要修改的現有相關檔案、元件和工具。
4.  **生成任務與任務說明：** 基於 PRD 分析和現狀評估，創建檔案並生成實作功能所需的主要任務。根據判斷決定使用多少個任務，通常約為 5-7 個。為每個任務生成詳細的任務說明（以條列式呈現），用於與開發者溝通開發範圍和實作細節，確保涵蓋 PRD 暗示的所有實作要點。**若使用者在對話中提及「TDD」，則建議標註「使用 TDD 開發流程」。**
5.  **生成驗收條件：** 基於 PRD 中的 Acceptance Criteria 部分，創建 Gherkin 格式的驗收測試場景。每個驗收條件應轉換為具體的 Feature、Scenario 和 Given/When/Then 步驟。這些步驟將由 AI 通過指令或 MCP 瀏覽器操作直接執行，而非傳統的 Cucumber glue code。
6.  **識別相關檔案：** 根據任務和 PRD，識別需要創建或修改的潛在檔案。在 `相關檔案` 部分列出這些檔案，包括對應的測試檔案（如適用）。
7.  **生成最終輸出：** 將任務、任務說明、相關檔案和備註結合到最終的 Markdown 結構中。在任務清單末尾添加驗收測試任務。
8.  **儲存檔案：**
    - 將任務清單儲存為 `implementation.md`
    - 將 Gherkin 驗收條件儲存為 `acceptance.feature`

## 輸出格式

### 任務清單 (implementation.md)

生成的任務清單**必須**遵循以下結構：

```markdown
# 實作計畫

## PRD 參考

**PRD 文件路徑：** `[PRD 檔案的相對路徑]`
**相關研究文件：** `[如果 PRD 引用了研究文件，列出研究文件路徑]`

> **重要提醒：** 實作過程中請經常參考 PRD 文件以了解：
>
> - 功能的商業目標和用戶價值
> - 完整的用戶故事和使用場景
> - 非功能性需求（性能、安全性等）
> - 系統架構和技術決策的背景脈絡
> - 研究文件中的深入分析和建議（如適用）

## 相關檔案

- `path/to/potential/file1.ts` - 簡要說明此檔案為何相關（例如：包含此功能的主要元件）。
- `path/to/another/file.tsx` - 簡要說明（例如：資料提交的 API 路由處理器）。
- `lib/utils/helpers.ts` - 簡要說明（例如：計算所需的工具函數）。
- `acceptance.feature` - Gherkin 格式的驗收測試場景

## 任務

- [ ] 1. 任務標題
  - 1.1 實作要點描述
  - 1.2 實作要點描述
  - 1.3 實作要點描述

- [ ] 2. 任務標題
  - 2.1 實作要點描述
  - 2.2 實作要點描述

- [ ] 3. 任務標題
  - 3.1 實作要點描述

- [ ] 4. 執行驗收測試
  - 4.1 使用 AI 讀取 acceptance.feature 檔案
  - 4.2 透過指令或 MCP 瀏覽器操作執行每個場景
  - 4.3 驗證所有場景通過並記錄結果
```

### 驗收條件檔案 (acceptance.feature)

Gherkin 格式的驗收條件**必須**遵循以下結構：

```gherkin
# language: zh-TW
功能: [功能名稱]
  作為 [使用者角色]
  我想要 [功能目標]
  以便 [商業價值]

  背景:
    假設 [系統初始狀態]
    並且 [額外的前置條件]

  場景: [場景名稱 - 對應 PRD 中的一個驗收條件]
    假設 [前置條件]
    當 [使用者執行的動作]
    那麼 [預期結果]
    並且 [額外的驗證]

  場景: [另一個場景名稱]
    假設 [前置條件]
    當 [使用者執行的動作]
    那麼 [預期結果]

  場景大綱: [參數化的場景]
    假設 用戶輸入 "<input>"
    當 系統處理輸入
    那麼 應該返回 "<output>"

    例子:
      | input | output |
      | 值1   | 結果1  |
      | 值2   | 結果2  |
```

### 驗收測試執行說明

驗收測試將由 AI 直接執行，而非使用傳統的 Cucumber step definitions：

1. **AI 讀取場景**：AI 解析 `acceptance.feature` 中的每個場景
2. **轉換為操作**：將 Given/When/Then 步驟轉換為：
   - 終端指令（用於 API 測試、檔案操作等）
   - MCP 瀏覽器操作（用於 UI 測試）
   - 資料驗證檢查
3. **執行與驗證**：依序執行每個步驟並驗證結果
4. **報告結果**：列出每個場景的執行結果，如果執行有預期之外的情況或是警告時請額外說明狀況

## 任務格式說明

- 每個任務使用核取方塊 `[ ]` 標記
- 任務編號採用簡單數字（1, 2, 3...）
- 任務說明以條列式呈現，編號格式為 X.Y（如 1.1, 1.2）
- 任務說明應涵蓋該任務的所有實作要點和開發範圍

### TDD 開發標註

若使用者在對話中提及「TDD」，則在**程式開發相關任務**的標題後附註使用 TDD 開發流程：

```markdown
- [ ] 1. 實作用戶註冊功能 - 使用 TDD 開發流程
  - 1.1 建立用戶數據驗證邏輯
  - 1.2 實作密碼加密和安全處理
  - 1.3 整合數據庫操作和錯誤處理

- [ ] 2. 設定開發環境和依賴
  - 2.1 安裝必要的套件
  - 2.2 配置資料庫連線

- [ ] 3. 建立 API 路由處理器 - 使用 TDD 開發流程
  - 3.1 設計 RESTful API 結構
  - 3.2 實作錯誤處理中介軟體
```

**注意：** 只有涉及程式邏輯實作的任務需要 TDD 標註。環境設定、文件撰寫、驗收測試等任務不需要 TDD 標註。TDD 開發流程將直接在 process-task-list 命令中執行，不再使用獨立的 agent。

## 目標受眾

假設任務清單的主要讀者是**初級開發人員**，他們將在了解現有程式碼庫背景的情況下實作功能。

